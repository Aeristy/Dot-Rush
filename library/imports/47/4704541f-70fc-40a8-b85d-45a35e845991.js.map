{"version":3,"sources":["assets\\Scripts\\BallController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameController from \"./GameController\";\nimport SoundController from \"./SoundController\";\nimport Utils from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class BallController extends cc.Component {\n  @property(cc.Vec2)\n  centerPos: cc.Vec2 = null;\n\n  @property(cc.Prefab)\n  ringEffectPrefab: cc.Prefab = null;\n\n  @property(cc.Prefab)\n  particleEffectPrefab: cc.Prefab = null;\n\n  duration = 1.2;\n\n  interval = 0.01;\n  time = this.interval;\n  target: cc.Node = null;\n  previous: cc.Node = null;\n  trailEnable: boolean = false;\n  ringEffect: cc.Node = null;\n  particleEffect: cc.Node = null;\n\n  // LIFE-CYCLE CALLBACKS:\n  updateDuration(duration: number) {\n    this.duration = duration;\n  }\n\n  onCollisionEnter(other: cc.Collider, self: cc.Collider) {\n    if (other.tag == self.tag) {\n      this.onHitEffect();\n      this.onHitSound();\n      let worldPos = self.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R);\n      let otherWorldPos = other.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R);\n\n      GameController.instance.addScore(1);\n      var deltaX = worldPos.x - otherWorldPos.x;\n      var deltaY = worldPos.y - otherWorldPos.y;\n      let normalizedDelta = cc.v2(deltaX, deltaY).normalize();\n\n      // var angle = Math.atan2(normalizedDelta.y,normalizedDelta.x) * 180 / Math.PI;\n      // cc.log(angle);\n      this.trailEnable = true;\n      cc.tween(this.node)\n        .to(this.duration * 0.5, { position: cc.v3(normalizedDelta.mul(2000)) })\n        .start();\n\n      this.scheduleOnce(function () {\n        GameController.instance.destroyBall();\n      }, this.duration * 0.4);\n    } else {\n      this.onHitEffect();\n      other.node.destroy();\n      GameController.instance.onGameOver();\n    }\n  }\n\n  onHitSound() {\n    if (Utils.random(0, 1) == 0) SoundController.instance.play(\"hit1\");\n    else SoundController.instance.play(\"hit1\");\n  }\n\n  onLoad() {\n    this.updateDuration(GameController.instance.duration);\n    this.target = this.node;\n    this.node.zIndex = 30000;\n  }\n\n  start() {}\n\n  addTrailt() {\n    this.time = this.interval;\n    let clone = new cc.Node();\n\n    clone.parent = this.node.parent;\n    clone.scale = this.target.scale;\n    clone.opacity = 200;\n    if (this.previous == null) clone.zIndex = 10000;\n    else clone.zIndex = this.previous.zIndex - 1;\n\n    let targetPos = this.node.convertToWorldSpaceAR(cc.Vec2.ZERO_R);\n    clone.position = cc.v3(this.node.x, this.node.y);\n\n    clone.addComponent(cc.Sprite).spriteFrame = this.target.getComponent(\n      cc.Sprite\n    ).spriteFrame;\n    clone.setContentSize(this.target.getContentSize());\n    cc.tween(clone)\n      .to(this.duration * 0.5, { opacity: 0 })\n      .start();\n    cc.tween(clone)\n      .to(this.duration * 0.5, { scale: 0 })\n      .start();\n\n    this.previous = clone;\n  }\n  onHitEffect() {\n    this.particleEffect = cc.instantiate(this.particleEffectPrefab);\n    this.particleEffect.zIndex = 2;\n    this.particleEffect.parent = this.node.parent;\n    this.particleEffect.position = cc.v3(this.node.x, this.node.y);\n    cc.tween(this.particleEffect)\n      .to(1, { opacity: 0 })\n      .then(cc.tween(this.particleEffect).removeSelf())\n      .start();\n\n    this.ringEffect = cc.instantiate(this.ringEffectPrefab);\n    this.ringEffect.zIndex = 3;\n    this.ringEffect.parent = this.node.parent;\n    this.ringEffect.scale = 1;\n    this.ringEffect.opacity = 125;\n    this.ringEffect.position = cc.v3(this.node.x, this.node.y);\n    cc.tween(this.ringEffect)\n      .to(0.2, { scale: 1.3, opacity: 200 })\n      .then(cc.tween(this.ringEffect).to(0.4, { scale: 0.5, opacity: 0 }))\n      .then(cc.tween(this.ringEffect).removeSelf())\n      .start();\n  }\n  update(dt) {\n    this.updateDuration(GameController.instance.duration);\n    if (!this.trailEnable) return;\n    if (this.time > 0) this.time -= dt;\n    else {\n      this.addTrailt();\n    }\n  }\n}\n"]}