{"version":3,"sources":["assets\\Scripts\\GameController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import SoundController from \"./SoundController\";\nimport UIController from \"./UIController\";\nimport Utils from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameController extends cc.Component {\n  static instance: GameController;\n\n  @property(cc.Node) redBall: cc.Node = null;\n  @property(cc.Node) blueBall: cc.Node = null;\n\n  @property(cc.Node)\n  center: cc.Node = null;\n\n  @property(Array(cc.Vec2))\n  ballSpawnPos: Array<cc.Vec2> = new Array<cc.Vec2>();\n\n  @property(Array(cc.Prefab))\n  ballPrefab: Array<cc.Prefab> = new Array<cc.Prefab>();\n\n  @property(cc.Label)\n  levelUpLabel: cc.Label = null;\n\n  currentScore = 0;\n\n  enemyBall: cc.Node = null;\n  duration = 1;\n  spinDuration = 0.25;\n  rotation = 0;\n\n  isSpawnable = false;\n  isGameOver = false;\n  isSpinning = false;\n\n  // LIFE-CYCLE CALLBACKS:\n  onLoad() {\n    GameController.instance = this;\n    // Utils.setLocal('bestScoreDotRush', 0);\n    var manager = cc.director.getCollisionManager();\n    manager.enabled = true;\n    this.scheduleOnce(function () {\n      this.isSpawnable = true;\n    }, 1);\n  }\n\n  spinCenter() {\n    if (!this.isGameOver && !this.isSpinning) {\n      if (Utils.random(0, 1) == 0) SoundController.instance.play(\"fire1\");\n      else SoundController.instance.play(\"fire2\");\n      this.rotation += 180;\n      cc.tween(this.center)\n        .to(this.spinDuration, { angle: -this.rotation })\n        .start();\n      this.isSpinning = true;\n      this.scheduleOnce(function () {\n        this.isSpinning = false;\n      }, this.spinDuration / 2);\n    }\n  }\n  spawnBall() {\n    let spawnPos = Utils.random(0, this.ballSpawnPos.length - 1);\n    let ballColor = Utils.random(0, this.ballPrefab.length - 1);\n    this.enemyBall = cc.instantiate(this.ballPrefab[ballColor]);\n    this.enemyBall.parent = this.node.parent.getChildByName(\"Gameplay\");\n    this.enemyBall.x = this.ballSpawnPos[spawnPos].x;\n    this.enemyBall.y = this.ballSpawnPos[spawnPos].y;\n    cc.tween(this.enemyBall)\n      .to(this.duration, { position: cc.v3(this.center.x, this.center.y) })\n      .start();\n  }\n  onGameOver() {\n    SoundController.instance.play(\"defeat\");\n    this.isGameOver = true;\n    this.destroyBall();\n    cc.tween(this.center).to(1, { angle: this.center.angle }).start();\n    this.scheduleOnce(function () {\n      UIController.instance.fadeInGameOver();\n    }, 1);\n  }\n  addScore(amount: number) {\n    this.currentScore += amount;\n    // SoundController.instance.play(\"GainScore\");\n    if (this.currentScore > JSON.parse(Utils.getLocal(\"bestScoreDotRush\"))) {\n      Utils.setLocal(\"bestScoreDotRush\", this.currentScore.toString());\n      UIController.instance.isNewBest = true;\n    }\n    UIController.instance.updateScore(this.currentScore);\n  }\n\n  levelUp() {\n    SoundController.instance.play(\"level\");\n    this.levelUpLabel.node.active = true;\n    this.levelUpLabel.node.opacity = 225;\n    this.duration = this.duration * 0.98;\n    this.spinDuration = this.spinDuration * 0.95;\n    var t2 = cc\n      .tween(this.levelUpLabel.node)\n      .to(1, { position: cc.v3(0, 450), opacity: 255 });\n    cc.tween(this.levelUpLabel.node)\n      .set({ position: cc.v3(0, 0) })\n      .then(t2)\n      .start();\n    this.scheduleOnce(function () {\n      this.levelUpLabel.node.active = false;\n    }, 1.3);\n  }\n  destroyBall() {\n    this.enemyBall.destroy();\n    this.enemyBall = null;\n  }\n  update(dt) {\n    this.node.on(\"touchstart\", this.spinCenter, this);\n    if (this.enemyBall == null && !this.isGameOver && this.isSpawnable) {\n      this.spawnBall();\n    }\n  }\n}\n"]}